<?php
/**
 * –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º (–£–î–ê–õ–ò–¢–¨ –ü–û–°–õ–ï –ü–†–û–í–ï–†–ö–ò!)
 */

error_reporting(E_ALL);
ini_set('display_errors', 1);

echo "<h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</h1>";
echo "<style>body{font-family:Arial,sans-serif;padding:20px;} table{border-collapse:collapse;margin:20px 0;} td,th{border:1px solid #ccc;padding:10px;text-align:left;} .ok{color:green;} .err{color:red;}</style>";

// 1. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ
echo "<h2>1. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ</h2>";
echo "<table>";
echo "<tr><td>PHP –≤–µ—Ä—Å–∏—è</td><td>" . phpversion() . "</td></tr>";
echo "<tr><td>–¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è</td><td>" . __DIR__ . "</td></tr>";
echo "<tr><td>Document Root</td><td>" . $_SERVER['DOCUMENT_ROOT'] . "</td></tr>";
echo "<tr><td>REQUEST_URI</td><td>" . $_SERVER['REQUEST_URI'] . "</td></tr>";
echo "<tr><td>SCRIPT_NAME</td><td>" . $_SERVER['SCRIPT_NAME'] . "</td></tr>";
echo "</table>";

// 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ admin/
echo "<h2>2. –§–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ admin/</h2>";
echo "<table>";
echo "<tr><th>–§–∞–π–ª</th><th>–°—É—â–µ—Å—Ç–≤—É–µ—Ç</th><th>–†–∞–∑–º–µ—Ä</th><th>–ü—Ä–∞–≤–∞</th><th>–ß–∏—Ç–∞–µ–º—ã–π</th></tr>";

$files = ['index.php', 'login.php', 'logout.php', 'add.php', 'edit.php', 'delete.php', 'delete-city.php', 'cleanup.php', 'cities.php'];

foreach ($files as $file) {
    $path = __DIR__ . '/' . $file;
    $exists = file_exists($path);
    $size = $exists ? filesize($path) . ' –±–∞–π—Ç' : '-';
    $perms = $exists ? substr(sprintf('%o', fileperms($path)), -4) : '-';
    $readable = $exists ? (is_readable($path) ? '–î–∞' : '–ù–µ—Ç') : '-';
    
    $class = $exists ? 'ok' : 'err';
    $status = $exists ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç';
    
    echo "<tr>";
    echo "<td>{$file}</td>";
    echo "<td class='{$class}'>{$status}</td>";
    echo "<td>{$size}</td>";
    echo "<td>{$perms}</td>";
    echo "<td>{$readable}</td>";
    echo "</tr>";
}
echo "</table>";

// 3. –í—Å–µ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (—Ä–µ–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞)
echo "<h2>3. –†–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ admin/</h2>";
echo "<pre>";
$allFiles = scandir(__DIR__);
foreach ($allFiles as $f) {
    if ($f !== '.' && $f !== '..') {
        $fullPath = __DIR__ . '/' . $f;
        $type = is_dir($fullPath) ? 'üìÅ' : 'üìÑ';
        $size = is_file($fullPath) ? ' (' . filesize($fullPath) . ' bytes)' : '';
        echo "{$type} {$f}{$size}\n";
    }
}
echo "</pre>";

// 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ includes/
echo "<h2>4. –§–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ includes/</h2>";
$includesPath = __DIR__ . '/../includes/';
if (is_dir($includesPath)) {
    echo "<pre>";
    $incFiles = scandir($includesPath);
    foreach ($incFiles as $f) {
        if ($f !== '.' && $f !== '..') {
            echo "üìÑ {$f}\n";
        }
    }
    echo "</pre>";
} else {
    echo "<p class='err'>‚ùå –ü–∞–ø–∫–∞ includes/ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!</p>";
}

// 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ .htaccess
echo "<h2>5. –ü—Ä–æ–≤–µ—Ä–∫–∞ .htaccess</h2>";
$htaccessPaths = [
    __DIR__ . '/.htaccess',
    __DIR__ . '/../.htaccess',
    $_SERVER['DOCUMENT_ROOT'] . '/.htaccess'
];

foreach ($htaccessPaths as $htpath) {
    echo "<h4>{$htpath}</h4>";
    if (file_exists($htpath)) {
        echo "<pre style='background:#f5f5f5;padding:10px;'>" . htmlspecialchars(file_get_contents($htpath)) . "</pre>";
    } else {
        echo "<p>–§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</p>";
    }
}

// 6. –¢–µ—Å—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ delete.php
echo "<h2>6. –¢–µ—Å—Ç —Å—Å—ã–ª–æ–∫</h2>";
echo "<p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–∂–∞—Ç—å:</p>";
echo "<ul>";
echo "<li><a href='delete.php?id=999'>delete.php?id=999</a> (—Ç–µ—Å—Ç —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º ID)</li>";
echo "<li><a href='./delete.php?id=999'>./delete.php?id=999</a></li>";
echo "<li><a href='/admin/delete.php?id=999'>/admin/delete.php?id=999</a></li>";
echo "</ul>";

// 7. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ delete.php
echo "<h2>7. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ delete.php (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤)</h2>";
$deletePath = __DIR__ . '/delete.php';
if (file_exists($deletePath)) {
    $content = file_get_contents($deletePath);
    echo "<pre style='background:#f5f5f5;padding:10px;'>" . htmlspecialchars(substr($content, 0, 500)) . "...</pre>";
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ BOM
    $bom = (substr($content, 0, 3) === "\xEF\xBB\xBF");
    if ($bom) {
        echo "<p class='err'>‚ö†Ô∏è –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç BOM (Byte Order Mark) - —ç—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã!</p>";
    }
} else {
    echo "<p class='err'>–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω</p>";
}

// 8. URL –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É
echo "<h2>8. –ö–∞–∫–æ–π URL –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É?</h2>";
echo "<p>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL –∏–∑ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –∫–æ–≥–¥–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞ 404 –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞:</p>";
echo "<form method='get'><input type='text' name='test_url' size='60' placeholder='–í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–π URL'>";
echo "<button type='submit'>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button></form>";

if (isset($_GET['test_url'])) {
    $testUrl = $_GET['test_url'];
    echo "<p>–ê–Ω–∞–ª–∏–∑ URL: <code>{$testUrl}</code></p>";
    $parsed = parse_url($testUrl);
    echo "<pre>" . print_r($parsed, true) . "</pre>";
}

echo "<hr><p style='color:red;'><b>‚ö†Ô∏è –£–î–ê–õ–ò–¢–ï –≠–¢–û–¢ –§–ê–ô–õ (debug.php) –ü–û–°–õ–ï –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò!</b></p>";
